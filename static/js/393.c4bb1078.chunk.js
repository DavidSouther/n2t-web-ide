"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[393],{1293:(t,e,s)=>{s.r(e),s.d(e,{CPU:()=>M,default:()=>R});var a=s(5072),r=s(4619),n=s(3478),c=s(1062),i=s(8963),l=s(7054),o=s(2201),u=s(4430);const d=new Int16Array([2,55944,0,64528,15,54018,1,64528,2,61584,54024,0,64648,2,55943,15,55943]);var p=s(1003),h=s(6845),m=s(4913),x=s(6604),b=s(5692),j=s(5969);function g(t,e){const s=new j.j(t.cpu.RAM,e),a=new j.j(t.cpu.ROM,e),r=new j.j(t.cpu.Screen,e),n=new o.qT(new j.j(t.cpu.RAM,e));return{A:t.cpu.A,D:t.cpu.D,PC:t.cpu.PC,RAM:s,ROM:a,Screen:r,Keyboard:n}}function f(){const{fs:t,setStatus:e,storage:s}=(0,h.useContext)(b.r),a=(0,h.useRef)((()=>{})),{initialState:r,reducers:n,actions:c}=(0,h.useMemo)((()=>function(t,e,s,a){let r=new p.o(new o.eD(d));const n={update(t){t.sim=g(r,a),t.test.highlight=r.currentStep?.span},setTest(t,e){let{tst:s,cmp:a}=e;t.test.tst=s??t.test.tst,t.test.cmp=a??t.test.cmp,t.test.out=""},testStep(t){t.test.out=r.log(),this.update(t)},testFinished(t){const s=(0,m.q)(t.test.cmp.trim(),r.log().trim());e(s?"Simulation successful: The output file is identical to the compare file":"Simulation error: The output file differs from the compare file")}},c={tick(){r.cpu.tick()},testStep(){const t=r.step();return a.current({action:"testStep"}),t&&a.current({action:"testFinished"}),t},resetRAM(){r.cpu.RAM.loadBytes([]),a.current({action:"update"}),e("Reset RAM")},toggleUseTest(){a.current({action:"update"})},resetCPU(){r.reset(),a.current({action:"setTest",payload:{}}),a.current({action:"update"}),e("Reset CPU")},reset(){this.resetCPU(),e("Reset CPU & RAM")},compileTest(t,s){a.current({action:"setTest",payload:{tst:t,cmp:s}});const n=u.qH.parse(t);return(0,l.dZ)(n)?(e("Failed to parse test"),!1):(e("Parsed tst"),r=p.o.from((0,l.Ok)(n),r.cpu.ROM),a.current({action:"update"}),!0)},initialize(){this.compileTest("repeat {\n  ticktock;\n}")}};return{initialState:{sim:g(r,a),test:{highlight:r.currentStep?.span,tst:"",cmp:"",out:""}},reducers:n,actions:c}}(0,e,0,a)),[t,e,s,a]),[i,j]=(0,x.C)(n,r);return a.current=j,{state:i,dispatch:a,actions:c}}var v=s(6791),C=s(8722),y=s(8398),S=s(558),k=s(864);const M=()=>{const{state:t,actions:e,dispatch:s}=f(),{toolStates:l}=(0,h.useContext)(C.Il),[o,u]=(0,x.i)(t.test.tst),[d,p]=(0,x.i)(t.test.out),[m,b]=(0,x.i)(t.test.cmp),[j,g]=(0,h.useState)(),[M,R]=(0,h.useState)("asm"),[w,A]=(0,h.useState)(!0),[P,T]=(0,h.useState)(0);(0,h.useEffect)((()=>{e.initialize()}),[e]),(0,h.useEffect)((()=>{l.setTool("cpu"),l.cpuState.rom&&(t.sim.ROM.loadBytes(l.cpuState.rom),l.cpuState.name&&(g(l.cpuState.name),l.cpuState.name.endsWith(".hack")&&R("bin")))}),[]),(0,h.useEffect)((()=>{l.setCpuState(j,Array.from(t.sim.ROM.map(((t,e)=>e))))}),[t]);const F=(0,h.useRef)(),O=(0,h.useRef)(),[D,E]=(0,h.useState)(!1);(0,h.useEffect)((()=>(F.current=new class extends r.B{async tick(){return e.tick(),!1}finishFrame(){s.current({action:"update"})}reset(){e.reset()}toggle(){s.current({action:"update"})}},O.current=new class extends r.B{async tick(){return e.testStep()}finishFrame(){s.current({action:"update"})}reset(){e.reset()}toggle(){s.current({action:"update"})}},E(!0),()=>{var t,e;null===(t=F.current)||void 0===t||t.stop(),null===(e=O.current)||void 0===e||e.stop()})),[e,s]);return(0,k.jsxs)("div",{className:"Page CpuPage grid",children:[(0,k.jsx)(c.ZP,{name:"ROM",displayEnabled:w,memory:t.sim.ROM,highlight:t.sim.PC,format:M,onUpload:t=>{g(t),e.reset()}}),(0,k.jsx)(c.ZP,{name:"RAM",displayEnabled:w,memory:t.sim.RAM,format:"hex",onChange:()=>{T(P+1)}}),(0,k.jsxs)(y.s,{className:"IO",header:(0,k.jsxs)(k.Fragment,{children:[j&&(0,k.jsx)("div",{className:"flex-0",children:j}),(0,k.jsx)("div",{className:"flex-1",children:D&&F.current&&(0,k.jsx)(v.D,{runner:F.current})})]}),children:[(0,k.jsx)(i.l,{memory:t.sim.Screen},P),(0,k.jsx)(n.N,{update:()=>{s.current({action:"update"})},keyboard:t.sim.Keyboard}),(0,k.jsxs)("label",{children:[(0,k.jsx)("input",{type:"checkbox",role:"switch",checked:w,onChange:()=>{A(!w)}}),(0,k.jsx)(a.cC,{id:"{0}",values:{0:w?"Disable display":"Enable display"}})]}),w&&(0,k.jsx)("div",{children:(0,k.jsxs)("dl",{children:[(0,k.jsx)("dt",{children:"PC"}),(0,k.jsx)("dd",{children:t.sim.PC}),(0,k.jsx)("dt",{children:"A"}),(0,k.jsx)("dd",{children:t.sim.A}),(0,k.jsx)("dt",{children:"D"}),(0,k.jsx)("dd",{children:t.sim.D})]})})]}),D&&(0,k.jsx)(S.F,{runner:O,tst:[o,u,t.test.highlight],out:[d,p],cmp:[m,b],onLoadTest:(t,s)=>{e.compileTest(t,s)}})]})},R=M},558:(t,e,s)=>{s.d(e,{F:()=>m});var a=s(5072),r=s(6845),n=s(1965),c=s(6791),i=s(7880),l=s(5692),o=s(4430),u=s(8722),d=s(9200),p=s(8398),h=s(864);const m=t=>{let{runner:e,tst:[s,m,x],cmp:[b,j],out:[g],disabled:f=!1,onLoadTest:v}=t;const{fs:C,setStatus:y}=(0,r.useContext)(l.r),{filePicker:S,tracking:k}=(0,r.useContext)(u.Il),[M,R]=(0,r.useState)("tst"),w=(0,r.useCallback)((t=>{R(t),k.trackEvent("tab","change",t)}),[k]),A=(0,r.useCallback)((async()=>{try{const t=await S.select(),e=await C.readFile(t),s=await C.readFile(t.replace(/\.tst$/,".cmp"));null===v||void 0===v||v(e,s)}catch(t){console.error(t),y("Failed to load test")}}),[S,y,C]);return(0,h.jsx)(p.s,{className:"_test_panel",header:(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{className:"flex-0",children:(0,h.jsx)(a.cC,{id:"Test"})}),(0,h.jsx)("div",{className:"flex-1",children:e.current&&(0,h.jsx)(c.D,{runner:e.current})}),(0,h.jsx)("div",{children:(0,h.jsx)("fieldset",{role:"group",children:(0,h.jsx)("button",{onClick:A,children:"\ud83d\udcc2"})})})]}),children:(0,h.jsxs)("div",{role:"tablist",style:{"--tab-count":"3"},children:[(0,h.jsx)("div",{role:"tab",id:"test-tab-tst","aria-controls":"test-tabpanel-tst","aria-selected":"tst"===M,children:(0,h.jsxs)("label",{children:[(0,h.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-tst",value:"tst",checked:"tst"===M,onChange:()=>w("tst")}),"Test Script"]})}),(0,h.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-tst",id:"test-tabpanel-tst",children:(0,h.jsx)(d.M,{value:s,onChange:m,grammar:o.qH.parser,language:"tst",highlight:x,disabled:f})}),(0,h.jsx)("div",{role:"tab",id:"test-tab-cmp","aria-controls":"test-tablpanel-cmp","aria-selected":"cmp"===M,children:(0,h.jsxs)("label",{children:[(0,h.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-cmp",value:"cmp",checked:"cmp"===M,onChange:()=>w("cmp")}),"Compare File"]})}),(0,h.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-cmp",id:"test-tabpanel-cmp",style:{position:"relative"},children:(0,h.jsx)(d.M,{value:b,onChange:j,grammar:i.lA.parser,language:"cmp",disabled:f})}),(0,h.jsx)("div",{role:"tab",id:"test-tab-out","aria-controls":"test-tabpanel-out","aria-selected":"out"===M,children:(0,h.jsxs)("label",{children:[(0,h.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-out",value:"out",checked:"out"===M,onChange:()=>w("out")}),"Output File"]})}),(0,h.jsx)("div",{role:"tabpanel",id:"test-tabpanel-out","aria-labelledby":"test-tab-out",children:(0,h.jsx)(n.M,{cmp:b,out:g})})]})})}},4913:(t,e,s)=>{s.d(e,{q:()=>n});var a=s(7054),r=s(7880);const n=(t,e)=>{const s=r.lA.parse(t),n=r.lA.parse(e);if((0,a.dZ)(s)||(0,a.dZ)(n))return!1;const c=(0,a.Ok)(s),i=(0,a.Ok)(n);for(let a=0;a<Math.min(c.length,i.length);a++){const t=c[a]??[],e=i[a]??[];for(let s=0;s<Math.max(t.length,e.length);s++){const a=t[s]??"",r=e[s]??"";if(null===a?.trim().match(/^\*+$/)&&r?.trim()!==a?.trim())return!1}}return!0}},5969:(t,e,s)=>{s.d(e,{j:()=>r});var a=s(2201);class r extends a.kG{dispatch;constructor(t,e){super(t,t.size,0),this.dispatch=e}async load(t,e){await super.load(t,e),this.dispatch.current({action:"update"})}}}}]);