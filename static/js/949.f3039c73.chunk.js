"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[949],{8582:function(t,n,e){e.d(n,{M:function(){return c}});var r=e(1026),i=e(7878),s=e(8365),a=e(4408),o=e(1585),u=e(4625),c=function(t){var n=t.className,e=void 0===n?"":n,c=t.out,l=t.cmp,f=t.zeroState,p=s.lA.parse(c),v=s.lA.parse(l);if((0,u.dZ)(p))return(0,i.jsxs)("details",{children:[(0,i.jsx)("summary",{children:"Failed to parse output"}),(0,i.jsx)("pre",{children:(0,a.j)((0,u.UG)(p))}),(0,i.jsx)("code",{children:(0,i.jsx)("pre",{children:c})})]});if((0,u.dZ)(v))return(0,i.jsxs)("details",{children:[(0,i.jsx)("summary",{children:"Failed to parse compare"}),(0,i.jsxs)("code",{children:[(0,i.jsx)("pre",{children:(0,a.j)((0,u.UG)(v))}),(0,i.jsx)("pre",{children:l})]})]});var d=(0,u.Ok)(v),m=(0,u.Ok)(p),k=0,y=(0,o.w)(0,Math.min(d.length,m.length)).map((function(t){var n,e,i=null!==(n=d[t])&&void 0!==n?n:[],s=null!==(e=m[t])&&void 0!==e?e:[];return(0,o.w)(0,Math.max(i.length,s.length)).map((function(t,n){var e,r;return[null!==(e=i[n])&&void 0!==e?e:"",null!==(r=s[n])&&void 0!==r?r:""]})).map((function(t){var n=(0,r.Z)(t,2),e=n[0],i=n[1],s={cmp:null!==e&&void 0!==e?e:'"',out:null!==i&&void 0!==i?i:'"',pass:null!==(null===e||void 0===e?void 0:e.trim().match(/^\*+$/))||(null===i||void 0===i?void 0:i.trim())===(null===e||void 0===e?void 0:e.trim())};return s.pass||(k+=1),s}))}));return(0,i.jsxs)("div",{className:"scroll-x "+e,children:[k>0&&(0,i.jsxs)("p",{children:[k," failure",1===k?"":"s"]}),y.length>0?(0,i.jsx)("table",{style:{fontFamily:"var(--font-family-monospace)",marginBottom:"none"},children:(0,i.jsx)("tbody",{children:y.map((function(t,n){return(0,i.jsx)("tr",{children:t.map((function(t,n){var e=t.cmp,r=t.out,s=t.pass;return(0,i.jsx)(h,{cmp:e,out:r,pass:s},n)}))},n)}))})}):null!==f&&void 0!==f?f:(0,i.jsx)("p",{children:"Execute test script to compare output."})]})},h=function(t){var n=t.cmp,e=t.out;return t.pass?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("td",{children:n})}):(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("td",{children:[(0,i.jsx)("ins",{children:n}),(0,i.jsx)("br",{}),(0,i.jsx)("del",{children:e})]})})}},6329:function(t,n,e){e.d(n,{Af:function(){return L},Gc:function(){return S},P9:function(){return D},lj:function(){return A},qP:function(){return T},tI:function(){return F},yE:function(){return x}});var r,i=e(3243),s=e(7597),a=e(7538),o=e(3943),u=e(1092),c=e(7791),h=e(1026),l=e(9422),f=e(7169),p=e(7591),v=e(4337),d=e(726),m=e(649),k=e(2951),y=e(1976),g=e(4649),Z=e(5541),b=e(1585),w=e(6531),A=1,x=0,S=function(){function t(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;(0,k.Z)(this,t),(0,g.Z)(this,"name",void 0),(0,g.Z)(this,"width",void 0),(0,g.Z)(this,"state",void 0),(0,g.Z)(this,"next",[]),this.name=n,this.width=e,this.state=(0,b.w)(0,this.width).map((function(){return x}))}return(0,y.Z)(t,[{key:"ensureWidth",value:function(t){(0,Z.hu)(t<=16,"Cannot widen past 16 to ".concat(t," bits")),this.width<t&&(this.width=t,this.state=[].concat((0,m.Z)(this.state),(0,m.Z)((0,b.w)(this.width,t).map((function(){return x})))))}},{key:"connect",value:function(t){this.next.push(t),t.busVoltage=this.busVoltage}},{key:"pull",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,Z.hu)(n>=0&&n<this.width,"Bit out of bounds: ".concat(this.name,"@").concat(n)),this.state[n]=t,this.next.forEach((function(e){return e.pull(t,n)}))}},{key:"voltage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(0,Z.hu)(t>=0&&t<this.width),this.state[t]}},{key:"busVoltage",get:function(){var t=this;return(0,b.w)(0,this.width).reduce((function(n,e){return n|t.state[e]<<e}),0)},set:function(t){var n,e=this,r=(0,d.Z)((0,b.w)(0,this.width));try{for(r.s();!(n=r.n()).done;){var i=n.value;this.state[i]=(t&1<<i)>>i}}catch(s){r.e(s)}finally{r.f()}this.next.forEach((function(t){return t.busVoltage=e.busVoltage}))}},{key:"toggle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=this.voltage(t)===x?A:x;this.pull(n,t)}}]),t}(),M=function(t){(0,p.Z)(e,t);var n=(0,v.Z)(e);function e(t,r){var i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,k.Z)(this,e),i=n.call(this,t.name),(0,g.Z)((0,f.Z)(i),"bus",void 0),(0,g.Z)((0,f.Z)(i),"start",void 0),(0,g.Z)((0,f.Z)(i),"width",void 0),i.bus=t,i.start=r,i.width=s,(0,Z.hu)(r>=0&&r+s<=t.width,"Mismatched InSubBus dimensions on ".concat(t.name," (").concat(s," + ").concat(r," > ").concat(t.width,")")),i.connect(t),i}return(0,y.Z)(e,[{key:"pull",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,Z.hu)(n>=0&&n<this.width),this.bus.pull(t,this.start+n)}},{key:"voltage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(0,Z.hu)(t>=0&&t<this.width),this.bus.voltage(this.start+t)}},{key:"busVoltage",get:function(){return this.bus.busVoltage>>this.start&j(this.width)},set:function(t){var n=this.bus.busVoltage&~j(this.width+this.start),e=this.bus.busVoltage&j(this.start),r=(t&j(this.width))<<this.start;this.bus.busVoltage=n|r|e}},{key:"connect",value:function(t){(0,Z.hu)(this.start+this.width<=t.width,"Mismatched InSubBus connection dimensions (From ".concat(t.name," to ").concat(this.name,")")),this.bus=t}}]),e}(S),P=function(t){(0,p.Z)(e,t);var n=(0,v.Z)(e);function e(t,r){var i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,k.Z)(this,e),i=n.call(this,t.name),(0,g.Z)((0,f.Z)(i),"bus",void 0),(0,g.Z)((0,f.Z)(i),"start",void 0),(0,g.Z)((0,f.Z)(i),"width",void 0),i.bus=t,i.start=r,i.width=s,(0,Z.hu)(r>=0&&s<=t.width,"Mismatched OutSubBus dimensions"),i.connect(t),i}return(0,y.Z)(e,[{key:"busVoltage",get:function(){return this.bus.busVoltage&j(this.width)},set:function(t){this.bus.busVoltage=(t&j(this.width+this.start))>>this.start}},{key:"connect",value:function(t){(0,Z.hu)(this.width<=t.width,"Mismatched OutSubBus connection dimensions"),this.bus=t}}]),e}(S),T=function(t){(0,p.Z)(e,t);var n=(0,v.Z)(e);function e(t,r){var i;return(0,k.Z)(this,e),i=n.call(this,t,16),(0,g.Z)((0,f.Z)(i),"value",void 0),i.value=r,i}return(0,y.Z)(e,[{key:"pullHigh",value:function(){}},{key:"pullLow",value:function(){}},{key:"voltage",value:function(){return 1&this.busVoltage}},{key:"busVoltage",get:function(){return this.value},set:function(t){}}]),e}(S),C=new T("true",65535),R=new T("false",0);function E(t){var n,e=null===(n=t.match((0,l.Z)(/([a-zA-Z]+)(\[(\d+)\])?/,{pin:1,w:3})))||void 0===n?void 0:n.groups,r=e.pin,i=e.w;return{pin:r,width:i?Number(i):1}}r=Symbol.iterator;var O=function(){function t(){(0,k.Z)(this,t),(0,g.Z)(this,"map",new Map)}return(0,y.Z)(t,[{key:"insert",value:function(t){var n=t.name;(0,Z.hu)(!this.map.has(n),"Pins already has ".concat(n,"!")),this.map.set(n,t)}},{key:"emplace",value:function(t,n){if(this.has(t))return this.get(t);var e=new S(t,n);return this.insert(e),e}},{key:"has",value:function(t){return this.map.has(t)}},{key:"get",value:function(t){return this.map.get(t)}},{key:"entries",value:function(){return this.map.values()}},{key:r,value:function(){return this.map[Symbol.iterator]()}}]),t}(),I=0,L=function(){function t(n,e,r){var i=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];(0,k.Z)(this,t),(0,g.Z)(this,"name",void 0),(0,g.Z)(this,"id",I++),(0,g.Z)(this,"ins",new O),(0,g.Z)(this,"outs",new O),(0,g.Z)(this,"pins",new O),(0,g.Z)(this,"parts",new Set),(0,g.Z)(this,"clockedPins",void 0),this.name=r;var o,u=(0,d.Z)(n);try{for(u.s();!(o=u.n()).done;){var c=o.value,h=void 0!==c.pin?c:E(c),l=h.pin,f=h.width,p=void 0===f?1:f;this.ins.insert(new S(l,p))}}catch(V){u.e(V)}finally{u.f()}var v,m=(0,d.Z)(e);try{for(m.s();!(v=m.n()).done;){var y=v.value,Z=void 0!==y.pin?y:E(y),b=Z.pin,A=Z.width,x=void 0===A?1:A;this.outs.insert(new S(b,x))}}catch(V){m.e(V)}finally{m.f()}var M,P=(0,d.Z)(s);try{for(P.s();!(M=P.n()).done;){var T=M.value,C=void 0!==T.pin?T:E(T),R=C.pin,L=C.width,D=void 0===L?1:L;this.pins.insert(new S(R,D))}}catch(V){P.e(V)}finally{P.f()}this.clockedPins=new Set(a),w.S.get().$.subscribe((function(){return i.eval()}))}return(0,y.Z)(t,[{key:"clocked",get:function(){if(this.clockedPins.size>0)return!0;var t,n=(0,d.Z)(this.parts);try{for(n.s();!(t=n.n()).done;){if(t.value.clocked)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"reset",value:function(){var t,n=(0,d.Z)(this.ins);try{for(n.s();!(t=n.n()).done;){var e=(0,h.Z)(t.value,2);e[0];e[1].busVoltage=0}}catch(s){n.e(s)}finally{n.f()}var r,i=(0,d.Z)(this.parts);try{for(i.s();!(r=i.n()).done;){r.value.reset()}}catch(s){i.e(s)}finally{i.f()}this.eval()}},{key:"in",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"in";return(0,Z.hu)(this.hasIn(t),"No in pin ".concat(t)),this.ins.get(t)}},{key:"out",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"out";return(0,Z.hu)(this.hasOut(t),"No in pin ".concat(t)),this.outs.get(t)}},{key:"hasIn",value:function(t){return this.ins.has(t)}},{key:"hasOut",value:function(t){return this.outs.has(t)}},{key:"pin",value:function(t){return(0,Z.hu)(this.pins.has(t)),this.pins.get(t)}},{key:"get",value:function(t,n){return this.ins.has(t)?this.ins.get(t):this.outs.has(t)?this.outs.get(t):this.pins.has(t)?this.pins.get(t):this.getBuiltin(t,n)}},{key:"getBuiltin",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(B.includes(t)){var e,r=(0,d.Z)(this.parts);try{for(r.s();!(e=r.n()).done;){var i=e.value,s=i.get(t,n);if(s)return s}}catch(a){r.e(a)}finally{r.f()}}}},{key:"isOutPin",value:function(t){return this.outs.has(t)}},{key:"wire",value:function(t,n){this.parts.add(t);var e,r=(0,d.Z)(n);try{for(r.s();!(e=r.n()).done;){var i=e.value,s=i.to,a=i.from;t.isOutPin(s.name)?this.wireOutPin(t,s,a):this.wireInPin(t,s,a)}}catch(o){r.e(o)}finally{r.f()}}},{key:"findPin",value:function(t,n){return"true"===t.toLowerCase()||"1"===t?C:"false"===t.toLowerCase()||"0"===t?R:this.ins.has(t)?this.ins.get(t):this.outs.has(t)?this.outs.get(t):this.pins.emplace(t,n)}},{key:"wireOutPin",value:function(t,n,e){var r,i,s,a=(0,Z.kP)(t.outs.get(n.name),(function(){return"Cannot wire to missing pin ".concat(n.name)}));null!==(r=n.width)&&void 0!==r||(n.width=a.width);var o=this.findPin(e.name,null!==(i=e.width)&&void 0!==i?i:n.width),u=this.pins.has(o.name);if(null!==(s=e.width)&&void 0!==s||(e.width=o.width),o instanceof T)throw new Error("Cannot wire to constant bus");u&&o instanceof S&&o.ensureWidth(e.start+e.width),(e.start>0||e.width!==o.width)&&(o=new M(o,e.start,e.width)),(n.start>0||n.width!==o.width)&&(o=new P(o,n.start,n.width)),a.connect(o)}},{key:"wireInPin",value:function(t,n,e){var r,i,s,a=(0,Z.kP)(t.ins.get(n.name),(function(){return"Cannot wire to missing pin ".concat(n.name)}));null!==(r=n.width)&&void 0!==r||(n.width=a.width);var o=this.findPin(e.name,null!==(i=e.width)&&void 0!==i?i:n.width);null!==(s=e.width)&&void 0!==s||(e.width=o.width),(n.start>0||n.width!==o.width)&&(a=new M(a,n.start,n.width)),["true","false"].includes(o.name)||(e.start>0||e.width!==o.width)&&(a=new P(a,e.start,e.width)),o.connect(a)}},{key:"eval",value:function(){var t,n=(0,d.Z)(this.parts);try{for(n.s();!(t=n.n()).done;){var e=t.value;C.next.forEach((function(t){return t.busVoltage=C.busVoltage})),R.next.forEach((function(t){return t.busVoltage=R.busVoltage})),e.eval()}}catch(r){n.e(r)}finally{n.f()}}},{key:"tick",value:function(){this.eval()}},{key:"tock",value:function(){this.eval()}},{key:"remove",value:function(){var t,n=(0,d.Z)(this.parts);try{for(n.s();!(t=n.n()).done;){t.value.remove()}}catch(e){n.e(e)}finally{n.f()}}},{key:"load",value:function(){var t=(0,c.Z)((0,u.Z)().mark((function t(n,e){var r,i,s;return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=(0,d.Z)(this.parts),t.prev=1,r.s();case 3:if((i=r.n()).done){t.next=10;break}if("ROM32K"!==(s=i.value).name){t.next=8;break}return t.next=8,s.load(n,e);case 8:t.next=3;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(1),r.e(t.t0);case 15:return t.prev=15,r.f(),t.finish(15);case 18:case"end":return t.stop()}}),t,this,[[1,12,15,18]])})));return function(n,e){return t.apply(this,arguments)}}()}]),t}(),D=function(t){(0,p.Z)(e,t);var n=(0,v.Z)(e);function e(){var t;return(0,k.Z)(this,e),(t=n.call(this,[],[])).outs.insert(R),t}return(0,y.Z)(e)}(L),V=new WeakMap,F=function(t){(0,p.Z)(e,t);var n=(0,v.Z)(e);function e(){var t;(0,k.Z)(this,e);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return t=n.call.apply(n,[this].concat(i)),(0,a.Z)((0,f.Z)(t),V,{writable:!0,value:w.S.get().$.subscribe((function(n){n.level===x?t.tock():t.tick()}))}),t}return(0,y.Z)(e,[{key:"clocked",get:function(){return!0}},{key:"remove",value:function(){(0,o.Z)(this,V).unsubscribe(),(0,i.Z)((0,s.Z)(e.prototype),"remove",this).call(this)}},{key:"reset",value:function(){(0,i.Z)((0,s.Z)(e.prototype),"reset",this).call(this),this.tick(),this.tock()}}]),e}(L);function j(t){return Math.pow(2,t)-1}var B=["Register","ARegister","DRegister","PC","RAM8","RAM64","RAM512","RAM4K","RAM16K","ROM32K","Screen","Keyboard","Memory"]},6531:function(t,n,e){e.d(n,{S:function(){return l}});var r,i=e(2951),s=e(1976),a=e(4649),o=e(1496),u=e(9810),c=e(5541),h=e(6329),l=function(){function t(){(0,i.Z)(this,t),(0,a.Z)(this,"level",h.yE),(0,a.Z)(this,"ticks",0),(0,a.Z)(this,"subject",new o.X({level:this.level,ticks:this.ticks})),(0,a.Z)(this,"frameSubject",new u.x),(0,a.Z)(this,"resetSubject",new u.x),(0,a.Z)(this,"$",this.subject),(0,a.Z)(this,"frame$",this.frameSubject),(0,a.Z)(this,"reset$",this.resetSubject)}return(0,s.Z)(t,[{key:"isHigh",get:function(){return this.level===h.lj}},{key:"isLow",get:function(){return this.level===h.yE}},{key:"next",value:function(){this.subject.next({level:this.level,ticks:this.ticks})}},{key:"reset",value:function(){this.level=h.yE,this.ticks=0,this.next(),this.resetSubject.next()}},{key:"tick",value:function(){(0,c.hu)(this.level===h.yE,"Can only tick up from LOW"),this.level=h.lj,this.next()}},{key:"tock",value:function(){(0,c.hu)(this.level===h.lj,"Can only tock down from HIGH"),this.level=h.yE,this.ticks+=1,this.next()}},{key:"toggle",value:function(){this.level===h.lj?this.tock():this.tick()}},{key:"eval",value:function(){this.tick(),this.tock()}},{key:"frame",value:function(){this.frameSubject.next()}},{key:"toString",value:function(){return"".concat(this.ticks).concat(this.level===h.lj?"+":"")}}],[{key:"get",value:function(){return void 0===r&&(r=new t),r}}]),t}()},6693:function(t,n,e){e.d(n,{Bb:function(){return u},NM:function(){return r},PH:function(){return i},Uc:function(){return s},lK:function(){return a},vU:function(){return o}});var r={op:{42:"0",63:"1",58:"-1",12:"x",48:"y",13:"!x",49:"!y",15:"-x",51:"-y",31:"x+1",55:"y+1",14:"x-1",50:"y-1",2:"x+y",19:"x-y",7:"y-x",0:"x&y",21:"x|y"}},i={asm:{0:42,1:63,"-1":58,D:12,A:48,M:48,"!D":13,"!A":49,"-D":15,"-A":51,"D+1":31,"A+1":55,"D-1":14,"A-1":50,"D+A":2,"D-A":19,"D-M":19,"A-D":7,"D&A":0,"D&M":0,"D|A":21,"D|M":21},op:{42:"0",63:"1",58:"-1",12:"D",48:"A",13:"!D",49:"!A",15:"-D",51:"-A",31:"D+1",55:"A+1",14:"D-1",50:"A-1",2:"D+A",19:"D-A",7:"A-D",0:"D&A",21:"D|A"}},s={asm:{"":0,M:1,D:2,MD:3,A:4,AM:5,AD:6,AMD:7},op:{0:"",1:"M",2:"D",3:"MD",4:"A",5:"AM",6:"AD",7:"AMD"}},a={asm:{"":0,JGT:1,JEQ:2,JGE:3,JLT:4,JNE:5,JLE:6,JMP:7},op:{0:"",1:"JGT",2:"JEQ",3:"JGE",4:"JLT",5:"JNE",6:"JLE",7:"JMP"}},o={1:"Positive",0:"Zero",15:"Negative",Positive:1,Zero:0,Negative:15};function u(t,n,e){var r=0;switch(t){case 42:r=0;break;case 63:r=1;break;case 58:r=-1;break;case 12:r=n;break;case 48:r=e;break;case 13:r=~n;break;case 49:r=~e;break;case 15:r=-n;break;case 51:r=-e;break;case 31:r=n+1;break;case 55:r=e+1;break;case 14:r=n-1;break;case 50:r=e-1;break;case 2:r=n+e;break;case 19:r=n-e;break;case 7:r=e-n;break;case 0:r=n&e;break;case 21:r=n|e}return[r&=65535,0===r?o.Zero:32768&r?o.Negative:o.Positive]}},134:function(t,n,e){e.d(n,{Ff:function(){return M},Jx:function(){return x},Z9:function(){return E},Zu:function(){return f},aL:function(){return S}});var r=e(2951),i=e(1976),s=e(7538),a=e(4649),o=e(2648),u=e(3943),c=e(1026),h=e(6693),l=e(5838);function f(){return{A:0,D:0,PC:0,ALU:0,flag:h.vU.Zero}}var p=32768,v=36864,d=36864,m=36864,k=4032,y=32800,g=32784,Z=32776,b=32769,w=32770,A=32772;function x(t){function n(n){return(t&n)===n}return{c:n(p),x1:n(v),x2:n(d),am:n(m),op:(t&k)>>6,d1:n(y),d2:n(g),d3:n(Z),j1:n(b),j2:n(w),j3:n(A)}}function S(t,n){var e=t.inM,r=t.instruction,i=n.A,s=n.D,a=n.PC,o=x(r),u=o.am?e:i,l=(0,h.Bb)(o.op,s,u),f=(0,c.Z)(l,2);return[{A:i,D:s,PC:a+1,ALU:f[0],flag:f[1]},o.d3]}function M(t,n){var e=t.inM,r=t.instruction,i=t.reset,s=n.A,a=n.D,o=n.PC,u=n.ALU,c=n.flag,l=x(r),f=l.j1&&c===h.vU.Positive,p=l.j2&&c===h.vU.Zero,v=l.j3&&c===h.vU.Negative;o=i?0:f||p||v?s:o,l.d2&&(a=u),l.c?l.d1&&(s=u):s=32767&r;var d=l.am?e:s,m=(0,h.Bb)(l.op,a,d);return u=m[0],c=m[1],[{addressM:s,outM:u,writeM:l.d3},{A:s,D:a,ALU:u,flag:c,PC:o}]}var P=new WeakMap,T=new WeakMap,C=new WeakMap,R=new WeakMap,E=function(){function t(n){var e=n.RAM,i=void 0===e?new l.FH:e,o=n.ROM;(0,r.Z)(this,t),(0,a.Z)(this,"RAM",void 0),(0,a.Z)(this,"ROM",void 0),(0,a.Z)(this,"Screen",void 0),(0,a.Z)(this,"Keyboard",void 0),(0,s.Z)(this,P,{writable:!0,value:0}),(0,s.Z)(this,T,{writable:!0,value:0}),(0,s.Z)(this,C,{writable:!0,value:0}),(0,s.Z)(this,R,{writable:!0,value:{A:0,D:0,PC:0,ALU:0,flag:h.vU.Zero}}),this.RAM=i,this.ROM=o,this.Screen=new l.kG(this.RAM,l.yJ,l.GD),this.Keyboard=new l.qT(this.RAM)}return(0,i.Z)(t,[{key:"state",get:function(){return(0,u.Z)(this,R)}},{key:"PC",get:function(){return(0,u.Z)(this,P)}},{key:"A",get:function(){return(0,u.Z)(this,T)}},{key:"D",get:function(){return(0,u.Z)(this,C)}},{key:"setA",value:function(t){(0,o.Z)(this,T,t)}},{key:"setD",value:function(t){(0,o.Z)(this,C,t)}},{key:"setPC",value:function(t){(0,o.Z)(this,P,t)}},{key:"reset",value:function(){(0,o.Z)(this,P,0),(0,o.Z)(this,T,0),(0,o.Z)(this,C,0)}},{key:"tick",value:function(){var t=function(t,n){var e=S(t,n),r=(0,c.Z)(e,2),i=r[0];return r[1],M(t,i)}({inM:this.RAM.get((0,u.Z)(this,T)),instruction:this.ROM.get((0,u.Z)(this,P)),reset:!1},{A:(0,u.Z)(this,T),D:(0,u.Z)(this,C),PC:(0,u.Z)(this,P),ALU:(0,u.Z)(this,C),flag:h.vU.Zero}),n=(0,c.Z)(t,2),e=n[0],r=e.addressM,i=e.outM,s=e.writeM,a=n[1],l=a.A,f=a.D,p=a.PC;(0,o.Z)(this,T,l),(0,o.Z)(this,C,f),(0,o.Z)(this,P,p),s&&this.RAM.set(r,i)}}]),t}()},5838:function(t,n,e){e.d(n,{FH:function(){return M},GD:function(){return g},I2:function(){return y},eD:function(){return S},eu:function(){return b},kG:function(){return A},qT:function(){return x},yJ:function(){return Z},zp:function(){return w}});var r,i,s=e(7169),a=e(7591),o=e(4337),u=e(649),c=e(1092),h=e(7791),l=e(2951),f=e(1976),p=e(4649),v=e(5541),d=e(7693),m=e(326),k=e(7930),y=["bin","dec","hex","asm"],g=16384,Z=131072,b=24576;r=Symbol.iterator;var w=function(){function t(n){(0,l.Z)(this,t),(0,p.Z)(this,"memory",void 0),this.memory=new Int16Array(n)}return(0,f.Z)(t,[{key:"size",get:function(){return this.memory.length}},{key:"get",value:function(t){var n;return t<0||t>=this.size?65535:null!==(n=this.memory[t])&&void 0!==n?n:0}},{key:"set",value:function(t,n){t>=0&&t<this.size&&(this.memory[t]=65535&n)}},{key:"reset",value:function(){this.memory.fill(0)}},{key:"update",value:function(t,n,e){var r;switch(e){case"asm":r=(0,d.op)(n);break;case"bin":r=(0,m.C$)(n);break;case"hex":r=(0,m.Af)(n);break;default:r=(0,m.o5)(n)}isFinite(r)&&r<=65535&&this.set(t,r)}},{key:"load",value:function(){var t=(0,h.Z)((0,c.Z)().mark((function t(n,e){return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=this,t.next=4,(0,k.zD)(n,e);case 4:t.t1=t.sent,t.t0.loadBytes.call(t.t0,t.t1),t.next=11;break;case 8:throw t.prev=8,t.t2=t.catch(0),new Error("Memory Failed to load file ".concat(e));case 11:case"end":return t.stop()}}),t,this,[[0,8]])})));return function(n,e){return t.apply(this,arguments)}}()},{key:"loadBytes",value:function(t){this.memory.set(new Int16Array(t)),this.memory.fill(0,t.length,this.size)}},{key:"range",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.size;return(0,u.Z)(this.memory.slice(t,n))}},{key:"map",value:function(t){var n=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.size;return(0,c.Z)().mark((function i(){var s;return(0,c.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:(0,v.hu)(e<=r),s=e;case 2:if(!(s<r)){i.next=8;break}return i.next=5,t(s,n.get(s));case 5:s++,i.next=2;break;case 8:case"end":return i.stop()}}),i)}))()}},{key:r,value:function(){return this.map((function(t,n){return n}))}}]),t}();i=Symbol.iterator;var A=function(){function t(n,e,r){(0,l.Z)(this,t),(0,p.Z)(this,"parent",void 0),(0,p.Z)(this,"size",void 0),(0,p.Z)(this,"offset",void 0),this.parent=n,this.size=e,this.offset=r}return(0,f.Z)(t,[{key:"get",value:function(t){return t<0||t>=this.size?65535:this.parent.get(this.offset+t)}},{key:"set",value:function(t,n){t>=0&&t<this.size&&this.parent.set(t+this.offset,n)}},{key:"update",value:function(t,n,e){t>=0&&t<this.size&&this.parent.update(t+this.offset,n,e)}},{key:"load",value:function(t,n){return this.parent.load(t,n)}},{key:"loadBytes",value:function(t){return this.parent.loadBytes(t)}},{key:"range",value:function(t,n){return this.parent.range(t,n)}},{key:"map",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.size;return this.parent.map(t,n+this.offset,e+this.offset)}},{key:i,value:function(){return this.map((function(t,n){return n}))}}]),t}(),x=function(t){(0,a.Z)(e,t);var n=(0,o.Z)(e);function e(t){return(0,l.Z)(this,e),n.call(this,t,1,24576)}return(0,f.Z)(e,[{key:"getKey",value:function(){return this.get(0)}},{key:"setKey",value:function(t){this.set(0,65535&t)}},{key:"clearKey",value:function(){this.set(0,0)}}]),e}(A),S=function(t){(0,a.Z)(e,t);var n=(0,o.Z)(e);function e(t){(0,l.Z)(this,e);var r=new Int16Array(e.SIZE);return r.set(t),n.call(this,r)}return(0,f.Z)(e)}(w);(0,p.Z)(S,"SIZE",32768);var M=function(t){(0,a.Z)(e,t);var n=(0,o.Z)(e);function e(){var t;return(0,l.Z)(this,e),t=n.call(this,e.SIZE),(0,p.Z)((0,s.Z)(t),"keyboard",new A((0,s.Z)(t),1,b)),(0,p.Z)((0,s.Z)(t),"screen",new A((0,s.Z)(t),Z,g)),t}return(0,f.Z)(e)}(w);(0,p.Z)(M,"SIZE",32768)},7930:function(t,n,e){e.d(n,{zD:function(){return a}});var r=e(1092),i=e(7791),s=e(2724);function a(t,n){return o.apply(this,arguments)}function o(){return(o=(0,i.Z)((0,r.Z)().mark((function t(n,e){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.endsWith(".hack")){t.next=2;break}return t.abrupt("return",h(n,e));case 2:if(!e.endsWith(".asm")){t.next=4;break}return t.abrupt("return",u(n,e));case 4:throw new Error("Cannot load file without hack or asm extension ".concat(e));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function u(t,n){return c.apply(this,arguments)}function c(){return(c=(0,i.Z)((0,r.Z)().mark((function t(n,e){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=s,t.next=3,n.readFile(e);case 3:return t.t1=t.sent,t.abrupt("return",t.t0.loadAsm.call(t.t0,t.t1));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function h(t,n){return l.apply(this,arguments)}function l(){return(l=(0,i.Z)((0,r.Z)().mark((function t(n,e){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=s,t.next=3,n.readFile(e);case 3:return t.t1=t.sent,t.abrupt("return",t.t0.loadHack.call(t.t0,t.t1));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},1510:function(t,n,e){e.d(n,{eP:function(){return a},rJ:function(){return u},y1:function(){return o},Pz:function(){return c}});var r=e(5640),i=e(326),s=e(4625),a="Unknown parse error",o={Base:r.Z.grammar('\nBase {\n  Root = Value*\n\n  At = at\n  Bang = bang\n  Bar = bar\n  CloseAngle = closeAngle\n  CloseBrace = closeBrace\n  CloseParen = closeParen\n  CloseSquare = closeSquare\n  Comma = comma\n  Dollar = dollar\n  Dot = dot\n  DoubleQuote = doubleQuote\n  Equal = equal\n  OpenAngle = openAngle\n  OpenBrace = openBrace\n  OpenParen = openParen\n  OpenSquare = openSquare\n  Percent = percent\n  Semi = semi\n  Underscore = underscore\n\n  at = "@"\n  bang = "!"\n  bar = "|"\n  closeAngle = ">"\n  closeBrace = "}"\n  closeParen = ")"\n  closeSquare = "]"\n  comma = ","\n  dollar = "$"\n  dot = "."\n  doubleQuote = "\\""\n  equal = "="\n  minus = "-"\n  newline = "\\r"? "\\n"\n  openAngle = "<"\n  openBrace = "{"\n  openParen = "("\n  openSquare = "["\n  percent = "%"\n  semi = ";"\n  underscore = "_"\n\n  Value = identifier | number | boolean\n\n  boolean = true | false\n  True = true\n  False = false\n  true = "true"\n  false = "false"\n\n  Name = identifier\n  identifier = (letter|underscore) (alnum|underscore|dot|dollar)*\n\n  Number = number\n  number = hexNumber | decNumber | binNumber\n  binNumber = ("%B") ("0"|"1")+\n  hexNumber = ("%X") hexDigit+\n  decNumber = ("%D")? (wholeDec | realDec)\n  wholeDec = minus? digit+\n  realDec = minus? digit* "." digit+\n\n  String = DoubleQuote (~doubleQuote any)* doubleQuote\n  \n  spaces := (lineComment | comment | space)*\n  commentStart = "/*"\n  commentEnd = "*/"\n  comment = commentStart (~commentEnd any)* commentEnd\n  lineCommentStart = "//"\n  lineComment = lineCommentStart (~"\\n" any)* "\\n"\n\n  List<elem, sep> = NonemptyListOf<elem, sep> sep?\n  EmptyList<elem, sep> = EmptyList<elem, sep> sep?\n}')},u=o.Base.createSemantics();function c(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return t.root};return function(r){try{var i,o,u=t.match(r);if(u.succeeded()){var c=n(u),h=e(c);return(0,s.Ok)(h)}return(0,s.UG)({message:null!==(i=u.message)&&void 0!==i?i:a,shortMessage:null!==(o=u.shortMessage)&&void 0!==o?o:a})}catch(l){return(0,s.UG)(l)}}}u.extendOperation("asIteration",{List:function(t,n){return t.asIteration()}}),u.addAttribute("value",{decNumber:function(t,n){return(0,i.o5)(n.sourceString)},wholeDec:function(t,n){return(0,i.o5)(n.sourceString)},binNumber:function(t,n){return(0,i.C$)(n.sourceString)},hexNumber:function(t,n){return(0,i.Af)(n.sourceString)},Number:function(t){return t.value},Name:function(t){return t.name},identifier:function(t,n){return this.sourceString}}),u.addAttribute("name",{identifier:function(t,n){return this.sourceString},Name:function(t){var n;return null===(n=this.child(0))||void 0===n?void 0:n.name}}),u.addAttribute("String",{String:function(t,n,e){return n.sourceString}})},8365:function(t,n,e){e.d(n,{lA:function(){return u}});var r=e(5640),i=e(1510),s="\nCmp <: Base {\n  Root := line*\n  line = bar cell+ newline?\n  cell = cellvalue bar\n  cellvalue = (~(bar|newline) any)*\n}",a=r.Z.grammar(s,i.y1),o=a.extendSemantics(i.rJ);o.addAttribute("cell",{cell:function(t,n){return t.sourceString}}),o.addAttribute("line",{line:function(t,n,e){return n.children.map((function(t){return t.cell}))}}),o.addAttribute("root",{Root:function(t){return t.children.map((function(t){return t.line}))}});var u={grammar:s,semantics:o,parser:a,parse:(0,i.Pz)(a,o)}},9647:function(t,n,e){e.d(n,{qH:function(){return u}});var r=e(5640),i=e(1510),s='\nTst <: Base {\n  Root := Tst\n  Tst = (TstStatement | TstRepeat | TstWhile)+\n\n  TstRepeat = Repeat Number? OpenBrace TstStatement+ CloseBrace\n  TstWhile = While Condition OpenBrace TstStatement+ CloseBrace\n  TstStatement = List<TstOperation, ","> (Semi | Bang)\n\n  TstOperation =\n    | TstFileOperation\n    | TstOutputListOperation\n    | TstEvalOperation\n    | TstSetOperation\n    | TstOutputOperation\n    | TstEchoOperation\n    | TstClearEchoOperation\n    | TstLoadROMOperation\n\n  TstLoadROMOperation = ROM32K Load FileName\n  TstFileOperation = FileOperation FileName?\n  TstOutputListOperation = "output-list" OutputFormat+\n  OutputFormat = Name Index? percent FormatStyle wholeDec dot wholeDec dot wholeDec\n  TstSetOperation = Set Name Index? Number\n  Index = OpenSquare wholeDec? CloseSquare\n  Condition = Value CompareOp Value\n  TstEvalOperation = Eval | Tick | Tock | TickTock | VmStep\n  TstOutputOperation = Output\n  TstEchoOperation = Echo String\n  TstClearEchoOperation = ClearEcho\n\n  FileName = Name\n  FileOperation = "load" | "output-file" | "compare-to"\n\n  Set = "set"\n  Eval = "eval"\n  Tick = "tick"\n  Tock = "tock"\n  TickTock = "ticktock"\n  VmStep = "vmstep"\n  Echo = "echo"\n  Repeat = "repeat"\n  ClearEcho = "clear-echo"\n  Output = "output"\n  OutputList = "output-list"\n  FormatStyle = "B"|"D"|"S"|"X"\n  ROM32K = "ROM32K"\n  Load = "load"\n  While = "while"\n\n  CompareOp = "<>" | "<=" | ">=" | "=" | "<" | ">"\n}',a=r.Z.grammar(s,i.y1),o=a.extendSemantics(i.rJ);o.extendAttribute("value",{Index:function(t,n,e){var r,i;return null!==(r=null===n||void 0===n||null===(i=n.child(0))||void 0===i?void 0:i.value)&&void 0!==r?r:-1}}),o.extendAttribute("name",{FileName:function(t){return t.name}}),o.addAttribute("index",{Index:function(t,n,e){var r,i;return null!==(r=null===(i=n.child(0))||void 0===i?void 0:i.value)&&void 0!==r?r:0}}),o.addAttribute("format",{OutputFormat:function(t,n,e,r,i,s,a,o,u){var c,h,l=t.name,f=r.sourceString,p=i.value,v=a.value,d=u.value;return{id:l,builtin:void 0!==(null===n||void 0===n?void 0:n.child(0)),address:null!==(c=null===n||void 0===n||null===(h=n.child(0))||void 0===h?void 0:h.value)&&void 0!==c?c:-1,style:f,width:v,lpad:p,rpad:d}}}),o.addAttribute("operation",{TstEvalOperation:function(t){return{op:t.sourceString}},TstOutputOperation:function(t){return{op:"output"}},TstOutputListOperation:function(t,n){return{op:"output-list",spec:n.children.map((function(t){return t.format}))}},TstSetOperation:function(t,n,e,r){var i,s,a={op:"set",id:n.name,value:r.value},o=null===(i=e.child(0))||void 0===i||null===(s=i.child(1))||void 0===s?void 0:s.child(0);return o&&(a.index=o.value),a},TstEchoOperation:function(t,n){return{op:"echo",message:n.String}},TstClearEchoOperation:function(t){return{op:"clear-echo"}},TstLoadROMOperation:function(t,n,e){return{op:"loadRom",file:e.name}},TstFileOperation:function(t,n){return{op:t.sourceString,file:null===n||void 0===n?void 0:n.sourceString}}}),o.addAttribute("condition",{Condition:function(t,n,e){var r=t.value,i=n.sourceString;return{left:r,right:e.value,op:i}}}),o.addAttribute("statement",{TstWhile:function(t,n,e,r,i){return{statements:r.children.map((function(t){return t.statement})),condition:n.condition,span:{start:t.source.startIdx,end:n.source.endIdx}}},TstRepeat:function(t,n,e,r,i){var s,a;return{statements:r.children.map((function(t){return t.statement})),count:null!==(s=null===(a=n.child(0))||void 0===a?void 0:a.value)&&void 0!==s?s:-1,span:{start:t.source.startIdx,end:n.source.endIdx}}},TstStatement:function(t,n){var e={ops:t.asIteration().children.map((function(t){return t.operation})),span:{start:this.source.startIdx,end:this.source.endIdx}};return"!"===n.sourceString&&(e.break=!0),e}}),o.addAttribute("tst",{Tst:function(t){return{lines:t.children.map((function(t){return t.statement}))}}}),o.addAttribute("root",{Root:function(t){return t.tst}});var u={grammar:s,semantics:o,parser:a,parse:(0,i.Pz)(a,o)}},5105:function(t,n,e){e.d(n,{VM:function(){return u}});var r=e(5640),i=e(1510),s='\nVm <: Base {\n  Root := Vm\n\n  Vm = VmInstruction*\n\n  VmInstruction =\n    | StackInstruction\n    | OpInstruction\n    | FunctionInstruction\n    | CallInstruction\n    | ReturnInstruction\n    | GotoInstruction\n    | LabelInstruction\n  \n  StackInstruction = (Push | Pop) MemorySegment Number\n  OpInstruction = Add | Sub | Neg | Lt | Gt | Eq | And | Or | Not\n  FunctionInstruction = Function Name Number \n  CallInstruction =  Call Name Number\n  ReturnInstruction = Return\n  LabelInstruction = Label Name\n  GotoInstruction = (Goto | IfGoto) Name\n\n  MemorySegment = Argument | Local | Static | Constant | This | That | Pointer | Temp\n\n  Push = "push"\n  Pop = "pop"\n  Function = "function"\n  Call = "call"\n  Return = "return"\n  Goto = "goto"\n  IfGoto = "if-goto"\n  Label = "label"\n\n  Argument = "argument"\n  Local = "local"\n  Static = "static"\n  Constant = "constant"\n  This = "this"\n  That = "that"\n  Pointer = "pointer"\n  Temp = "temp"\n\n  Add = "add" \n  Sub = "sub" \n  Neg = "neg" \n  Eq = "eq"\n  Lt = "lt" \n  Gt = "gt" \n  And = "and" \n  Or = "or" \n  Not = "not"\n}',a=r.Z.grammar(s,i.y1),o=a.extendSemantics(i.rJ);o.addAttribute("op",{Push:function(t){return"push"},Pop:function(t){return"pop"},Function:function(t){return"function"},Call:function(t){return"call"},Return:function(t){return"return"},Goto:function(t){return"goto"},IfGoto:function(t){return"if-goto"},Label:function(t){return"label"},Add:function(t){return"add"},Sub:function(t){return"sub"},Neg:function(t){return"neg"},Eq:function(t){return"eq"},Lt:function(t){return"lt"},Gt:function(t){return"gt"},And:function(t){return"and"},Or:function(t){return"or"},Not:function(t){return"not"}}),o.addAttribute("segment",{Argument:function(t){return"argument"},Local:function(t){return"local"},Static:function(t){return"static"},Constant:function(t){return"constant"},This:function(t){return"this"},That:function(t){return"that"},Pointer:function(t){return"pointer"},Temp:function(t){return"temp"}}),o.addAttribute("instruction",{StackInstruction:function(t,n,e){return{op:t.op,segment:n.segment,offset:e.value}},OpInstruction:function(t){return{op:t.op}},FunctionInstruction:function(t,n,e){return{op:"function",name:n.name,nVars:e.value}},CallInstruction:function(t,n,e){return{op:"call",name:n.name,nArgs:e.value}},ReturnInstruction:function(t){return{op:"return"}},LabelInstruction:function(t,n){return{op:"label",label:n.name}},GotoInstruction:function(t,n){return{op:t.op,label:n.name}}}),o.addAttribute("vm",{Vm:function(t){return{instructions:t.children.map((function(t){return t.instruction}))}}}),o.addAttribute("root",{Root:function(t){return t.vm}});var u={grammar:s,semantics:o,parser:a,parse:(0,i.Pz)(a,o)}},2724:function(t,n,e){e.r(n),e.d(n,{loadAsm:function(){return w},loadBlob:function(){return M},loadHack:function(){return x}});var r=e(1092),i=e(7791),s=e(4625),a=e(726),o=e(5541),u=e(5640),c=e(6693),h=e(5838),l=e(7693),f=e(1510),p='\nASM <: Base {\n  Root := ASM\n  ASM = Instruction*\n  \n  Instruction = Label|AInstruction|CInstruction\n  \n  Label = OpenParen identifier closeParen\n  AInstruction = at (identifier | decNumber)\n  CInstruction = assign? op jmp?\n  \n  assign = (\n      "AMD"\n      | "AM"\n      | "AD"\n      | "MD"\n      | "M"\n      | "D"\n      | "A"\n      ) equal\n      \n  op =\n      | "0" | "1" | "-1"\n      | "!D" | "!A" | "!M"\n      | "-D" | "-A" | "-M"\n      | "D+1" | "A+1" | "M+1"\n      | "D-1" | "A-1" | "M-1"\n      | "D+A" | "D+M"\n      | "D-A" | "D-M"\n      | "A-D" | "M-D"\n      | "D&A" | "D&M"\n      | "D|A" | "D|M"\n      | "D" | "A" | "M"\n\n\n  jmp = semi ("JGT" | "JEQ" | "JGE" | "JLT" | "JNE" | "JLE" | "JMP")\n}',v=u.Z.grammar(p,f.y1),d=v.extendSemantics(f.rJ);function m(t){return void 0!==t.label}d.addAttribute("root",{Root:function(t){return this.asm}}),d.addAttribute("asm",{Root:function(t){return{instructions:t.child(0).children.map((function(t){return t.instruction}))}}}),d.addAttribute("instruction",{AInstruction:function(t,n){try{return{type:"A",label:n.name}}catch(e){}try{return{type:"A",value:n.value}}catch(e){}throw new Error("AsmAInstruction must have either a name or a value")},CInstruction:function(t,n,e){var r,i,s,a,o=null===(r=t.child(0))||void 0===r||null===(i=r.child(0))||void 0===i?void 0:i.sourceString,u=n.sourceString.replace("M","A"),h=null===(s=e.child(0))||void 0===s||null===(a=s.child(1))||void 0===a?void 0:a.sourceString,l=t.sourceString.includes("M")||n.sourceString.includes("M"),f={type:"C",op:c.PH.asm[u],isM:l};return h&&(f.jump=c.lK.asm[h]),o&&(f.store=c.Uc.asm[o]),f},Label:function(t,n,e){return{type:"L",label:n.name}}});var k=function(t){if("A"===t.type){if(m(t))throw new Error("ASM Emitting unfilled A instruction");return t.value}if("C"===t.type)return(0,l.p)(t.isM,t.op,t.store,t.jump)};var y=function(t){return"string"===typeof t?{type:"A",label:t}:{type:"A",value:t}},g=function(t,n,e){var r=t.includes("M")||n.includes("M"),i={type:"C",op:c.PH.asm[n],isM:r};return e&&(i.jump=c.lK.asm[e]),t&&(i.store=c.Uc.asm[t]),i},Z={grammar:p,semantics:d,parser:v,parse:(0,f.Pz)(v,d),passes:{fillLabel:function(t){var n,e=16,r=new Map([["R0",0],["R1",1],["R2",2],["R3",3],["R4",4],["R5",5],["R6",6],["R7",7],["R8",8],["R9",9],["R10",10],["R11",11],["R12",12],["R13",13],["R14",14],["R15",15],["SP",0],["LCL",1],["ARG",2],["THIS",3],["THAT",4],["SCREEN",h.GD],["KBD",h.eu]]),i=[],s=0,u=(0,a.Z)(t.instructions);try{for(u.s();!(n=u.n()).done;){var c=n.value;if("L"!==c.type)s+=1,"A"===c.type&&m(c)&&i.push(c);else{if(r.has(c.label))throw new Error("ASM Duplicate label ".concat(c.label));r.set(c.label,s)}}}catch(l){u.e(l)}finally{u.f()}i.forEach((function(t){var n,i=(n=t.label,r.has(n)||(r.set(n,e),e+=1),(0,o.kP)(r.get(n),"Label not in symbols: ".concat(n)));t.value=i,delete t.label}))},emit:function(t){return t.instructions.map(k).filter((function(t){return void 0!==t}))}},A:y,C:g,AC:function(t,n,e,r){return[y(t),g(n,e,r)]},L:function(t){return{type:"L",label:t}}},b=e(326);function w(t){return A.apply(this,arguments)}function A(){return A=(0,i.Z)((0,r.Z)().mark((function t(n){var e;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=(0,s.Wg)(Z.parse(n)),Z.passes.fillLabel(e),t.abrupt("return",Z.passes.emit(e));case 3:case"end":return t.stop()}}),t)}))),A.apply(this,arguments)}function x(t){return S.apply(this,arguments)}function S(){return(S=(0,i.Z)((0,r.Z)().mark((function t(n){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",n.split("\n").filter((function(t){return""!==t.trim()})).map(b.C$));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function M(t){return P.apply(this,arguments)}function P(){return(P=(0,i.Z)((0,r.Z)().mark((function t(n){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",n.split("\n").filter((function(t){return""!==t.trim()})).map(b.t1));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},1485:function(t,n,e){e.d(n,{h:function(){return I}});var r=e(726),i=e(5541),s=e(7423),a=e(7791),o=e(7169),u=e(7591),c=e(4337),h=e(1092),l=e(2951),f=e(1976),p=e(4649),v=e(9422),d=e(326),m=function(){function t(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"%B1.1.1",r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0;if((0,l.Z)(this,t),(0,p.Z)(this,"variable",void 0),(0,p.Z)(this,"fmt",void 0),(0,p.Z)(this,"lPad",void 0),(0,p.Z)(this,"rPad",void 0),(0,p.Z)(this,"len",void 0),(0,p.Z)(this,"index",void 0),(0,p.Z)(this,"builtin",void 0),this.variable=n,e.startsWith("%")&&void 0===r&&void 0===s&&void 0===a){var c,h=null===(c=e.match((0,v.Z)(/^%([BDXS])(\d+)\.(\d+)\.(\d+)$/,{fmt:1,lPad:2,len:3,rPad:4})))||void 0===c?void 0:c.groups,f=h.fmt,d=h.lPad,m=h.rPad,k=h.len;this.fmt=f,this.lPad=parseInt(d),this.rPad=parseInt(m),this.len=parseInt(k),this.builtin=!1,this.index=-1}else(0,i.hu)(["B","X","D","S"].includes(e[0])),this.fmt=e[0],this.len=null!==r&&void 0!==r?r:3,this.lPad=null!==s&&void 0!==s?s:1,this.rPad=null!==a&&void 0!==a?a:1,this.builtin=null!==o&&void 0!==o&&o,this.index=null!==u&&void 0!==u?u:-1}return(0,f.Z)(t,[{key:"header",value:function(t){var n="".concat(this.variable);if(this.builtin){var e=this.index>=0?this.index:"";n="".concat(n,"[").concat(e,"]")}return n.length>this.len+this.lPad+this.rPad?n.substring(0,this.len+this.lPad+this.rPad):this.padCenter(n)}},{key:"print",value:function(t){var n=t.getVar(this.variable,this.index);if("S"===this.fmt)return this.padLeft(n);var e=(0,{B:d.Ly,D:d.E_,X:d.$v}[this.fmt])(n);return"D"===this.fmt?this.padRight(e):this.padCenter(e.slice(e.length-this.len))}},{key:"padCenter",value:function(t){var n=this.lPad+this.len+this.rPad,e=Math.floor((n-t.length)/2),r=n-e-t.length,i=e+t.length,s=i+r;return t=(t=t.padStart(i)).padEnd(s)}},{key:"padLeft",value:function(t){t=t.substring(0,this.len);var n=this.rPad+this.len,e=this.lPad+n;return t=(t=t.padEnd(n)).padStart(e)}},{key:"padRight",value:function(t){t=t.substring(0,this.len);var n=this.lPad+this.len,e=this.rPad+n;return t=(t=t.padStart(n)).padEnd(e)}}]),t}(),k=function(){function t(n,e,r){(0,l.Z)(this,t),(0,p.Z)(this,"variable",void 0),(0,p.Z)(this,"value",void 0),(0,p.Z)(this,"index",void 0),this.variable=n,this.value=e,this.index=r}return(0,f.Z)(t,[{key:"do",value:function(t){t.setVar(this.variable,this.value,this.index)}},{key:"steps",value:(0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),y=function(){function t(){(0,l.Z)(this,t)}return(0,f.Z)(t,[{key:"do",value:function(t){t.output()}},{key:"steps",value:(0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),g=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];(0,l.Z)(this,t),(0,p.Z)(this,"outputs",[]);var e,i=(0,r.Z)(n);try{for(i.s();!(e=i.n()).done;){var s=e.value;this.addOutput(s)}}catch(a){i.e(a)}finally{i.f()}}return(0,f.Z)(t,[{key:"addOutput",value:function(t){this.outputs.push(new m(t.id,t.style,t.width,t.lpad,t.rpad,t.builtin,t.address))}},{key:"do",value:function(t){t.outputList(this.outputs),t.header()}},{key:"steps",value:(0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),Z=function(){function t(){(0,l.Z)(this,t),(0,p.Z)(this,"instructions",[]),(0,p.Z)(this,"span",void 0)}return(0,f.Z)(t,[{key:"addInstruction",value:function(t){this.instructions.push(t)}},{key:"do",value:function(t){var n,e=(0,r.Z)(this.instructions);try{for(e.s();!(n=e.n()).done;){n.value.do(t)}}catch(i){e.e(i)}finally{e.f()}}},{key:"steps",value:(0,h.Z)().mark((function t(n){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),b=function(t){(0,u.Z)(e,t);var n=(0,c.Z)(e);function e(t){var r;return(0,l.Z)(this,e),r=n.call(this),(0,p.Z)((0,o.Z)(r),"repeat",void 0),r.repeat=t,r}return(0,f.Z)(e,[{key:"do",value:function(){}},{key:"innerSteps",value:(0,h.Z)().mark((function t(n){var e,i,s;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=(0,r.Z)(this.instructions),t.prev=1,e.s();case 3:if((i=e.n()).done){t.next=8;break}return s=i.value,t.delegateYield(s.steps(n),"t0",6);case 6:t.next=3;break;case 8:t.next=13;break;case 10:t.prev=10,t.t1=t.catch(1),e.e(t.t1);case 13:return t.prev=13,e.f(),t.finish(13);case 16:case"end":return t.stop()}}),t,this,[[1,10,13,16]])}))},{key:"steps",value:(0,h.Z)().mark((function t(n){var e;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(-1!==this.repeat){t.next=9;break}return t.next=3,this;case 3:return t.delegateYield(this.innerSteps(n),"t0",5);case 5:t.next=3;break;case 7:t.next=17;break;case 9:e=0;case 10:if(!(e<this.repeat)){t.next=17;break}return t.next=13,this;case 13:return t.delegateYield(this.innerSteps(n),"t1",14);case 14:e++,t.next=10;break;case 17:case"end":return t.stop()}}),t,this)}))}]),e}(Z),w=function(){function t(n,e,r){(0,l.Z)(this,t),(0,p.Z)(this,"x",void 0),(0,p.Z)(this,"y",void 0),(0,p.Z)(this,"op",void 0),this.x=n,this.y=e,this.op=r}return(0,f.Z)(t,[{key:"check",value:function(t){var n=t.hasVar(this.x)?t.getVar(this.x):this.x,e=t.hasVar(this.y)?t.getVar(this.y):this.y;if("string"===typeof n||"string"===typeof e)switch(this.op){case"=":return"".concat(n)==="".concat(e);case"<>":return"".concat(n)!=="".concat(e)}else switch(this.op){case"<":return n<e;case"<=":return n<=e;case">":return n>e;case">=":return n>=e;case"=":return n===e;case"<>":return n!==e}return!1}}]),t}(),A=function(t){(0,u.Z)(e,t);var n=(0,c.Z)(e);function e(t){var r;return(0,l.Z)(this,e),r=n.call(this),(0,p.Z)((0,o.Z)(r),"condition",void 0),r.condition=t,r}return(0,f.Z)(e,[{key:"steps",value:(0,h.Z)().mark((function t(n){var e,i,s;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.condition.check(n)){t.next=21;break}return t.next=3,this;case 3:e=(0,r.Z)(this.instructions),t.prev=4,e.s();case 6:if((i=e.n()).done){t.next=11;break}return s=i.value,t.delegateYield(s.steps(n),"t0",9);case 9:t.next=6;break;case 11:t.next=16;break;case 13:t.prev=13,t.t1=t.catch(4),e.e(t.t1);case 16:return t.prev=16,e.f(),t.finish(16);case 19:t.next=0;break;case 21:case"end":return t.stop()}}),t,this,[[4,13,16,19]])}))}]),e}(Z),x=function(){function t(n){(0,l.Z)(this,t),(0,p.Z)(this,"content",void 0),this.content=n}return(0,f.Z)(t,[{key:"do",value:function(t){t.echo(this.content)}},{key:"steps",value:(0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),S=function(){function t(){(0,l.Z)(this,t)}return(0,f.Z)(t,[{key:"do",value:function(t){t.clearEcho()}},{key:"steps",value:(0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),M=function(){function t(n){(0,l.Z)(this,t),(0,p.Z)(this,"file",void 0),this.file=n}return(0,f.Z)(t,[{key:"do",value:function(){var t=(0,a.Z)((0,h.Z)().mark((function t(n){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.fs.pushd("/samples"),t.next=3,n.load(this.file);case 3:n.fs.popd();case 4:case"end":return t.stop()}}),t,this)})));return function(n){return t.apply(this,arguments)}}()},{key:"steps",value:(0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),P=e(184),T=e(4499);function C(t){return void 0!==t.ops}function R(t){return void 0!==t.condition}function E(t){var n=new Z;n.span=t.span;var e,i=(0,r.Z)(t.ops);try{for(i.s();!(e=i.n()).done;){var s=O(e.value);void 0!==s&&n.addInstruction(s)}}catch(a){i.e(a)}finally{i.f()}return n}function O(t){var n=t.op;switch(n){case"tick":return new s.oK;case"tock":return new s.mL;case"ticktock":return new T.r;case"eval":return new s.Mb;case"vmstep":return new P.R;case"output":return new y;case"set":return new k(t.id,t.value,t.index);case"output-list":return new g(t.spec);case"echo":return new x(t.message);case"clear-echo":return new S;case"loadRom":return new M(t.file);case"load":case"output-file":case"compare-to":return;default:(0,i.qV)(n,"Unknown tst operation ".concat(n))}}function I(t,n){var e,i=(0,r.Z)(n.lines);try{for(i.s();!(e=i.n()).done;){var s=e.value;if(C(s))t.addInstruction(E(s));else{var a=R(s)?new A(new w(s.condition.left,s.condition.right,s.condition.op)):new b(s.count);a.span=s.span,t.addInstruction(a);var o,u=(0,r.Z)(s.statements);try{for(u.s();!(o=u.n()).done;){var c=o.value;a.addInstruction(E(c))}}catch(h){u.e(h)}finally{u.f()}}}}catch(h){i.e(h)}finally{i.f()}return t.reset(),t}},7423:function(t,n,e){e.d(n,{Mb:function(){return k},l1:function(){return m},mL:function(){return g},oK:function(){return y}});var r=e(1092),i=e(7791),s=e(2951),a=e(1976),o=e(7169),u=e(3243),c=e(7597),h=e(7591),l=e(4337),f=e(4649),p=e(6329),v=e(6531),d=e(1485),m=function(t){(0,h.Z)(e,t);var n=(0,l.Z)(e);function e(){var t;(0,s.Z)(this,e);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=n.call.apply(n,[this].concat(i)),(0,f.Z)((0,o.Z)(t),"chip",new p.P9),(0,f.Z)((0,o.Z)(t),"clock",v.S.get()),t}return(0,a.Z)(e,[{key:"chipId",get:function(){return this.chip.id}},{key:"with",value:function(t){return this.chip=t,this}},{key:"hasVar",value:function(t){return"time"===t||(t="".concat(t),this.chip.hasIn(t)||this.chip.hasOut(t))}},{key:"getVar",value:function(t,n){if("time"===(t="".concat(t)))return this.clock.toString();var e=this.chip.get(t,n);return e?e instanceof p.Gc?e.busVoltage:e.voltage():0}},{key:"setVar",value:function(t,n,e){var r=this.chip.get(t,e);r instanceof p.Gc?r.busVoltage=n:null===r||void 0===r||r.pull(0===n?p.yE:p.lj)}},{key:"eval",value:function(){this.chip.eval()}},{key:"tick",value:function(){this.chip.eval(),this.clock.tick()}},{key:"tock",value:function(){this.chip.eval(),this.clock.tock()}},{key:"load",value:function(){var t=(0,i.Z)((0,r.Z)().mark((function t(n){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.chip.load(this.fs,n);case 2:case"end":return t.stop()}}),t,this)})));return function(n){return t.apply(this,arguments)}}()},{key:"run",value:function(){var t=(0,i.Z)((0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.clock.reset(),t.next=3,(0,u.Z)((0,c.Z)(e.prototype),"run",this).call(this);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}],[{key:"from",value:function(t){var n=new e;return(0,d.h)(n,t)}}]),e}(e(653).e),k=function(){function t(){(0,s.Z)(this,t),(0,f.Z)(this,"_chipTestInstruction_",!0)}return(0,a.Z)(t,[{key:"do",value:function(t){t.eval()}},{key:"steps",value:(0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),y=function(){function t(){(0,s.Z)(this,t),(0,f.Z)(this,"_chipTestInstruction_",!0)}return(0,a.Z)(t,[{key:"do",value:function(t){t.tick()}},{key:"steps",value:(0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}(),g=function(){function t(){(0,s.Z)(this,t),(0,f.Z)(this,"_chipTestInstruction_",!0)}return(0,a.Z)(t,[{key:"do",value:function(t){t.tock()}},{key:"steps",value:(0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}()},4499:function(t,n,e){e.d(n,{o:function(){return d},r:function(){return m}});var r=e(1092),i=e(7791),s=e(2951),a=e(1976),o=e(7169),u=e(7591),c=e(4337),h=e(4649),l=e(5838),f=e(134),p=e(653),v=e(1485),d=function(t){(0,u.Z)(e,t);var n=(0,c.Z)(e);function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new l.eD(new Int16Array);return(0,s.Z)(this,e),t=n.call(this),(0,h.Z)((0,o.Z)(t),"cpu",void 0),(0,h.Z)((0,o.Z)(t),"ticks",0),t.cpu=new f.Z9({ROM:r}),t.reset(),t}return(0,a.Z)(e,[{key:"reset",value:function(){return this.cpu.reset(),this.ticks=0,this}},{key:"hasVar",value:function(t){return"number"!==typeof t&&!("A"!==t&&"D"!==t&&"PC"!==t&&"time"!==t&&!t.startsWith("RAM"))}},{key:"getVar",value:function(t){switch(t){case"A":return this.cpu.A;case"D":return this.cpu.D;case"PC":return this.cpu.PC;case"time":return this.ticks}if("number"===typeof t)return 0;if(t.startsWith("RAM")){var n=Number(t.substring(4,t.length-1));return this.cpu.RAM.get(n)}return 0}},{key:"setVar",value:function(t,n,e){switch(t){case"A":this.cpu.setA(n);break;case"D":this.cpu.setD(n);break;case"PC":this.cpu.setPC(n);break;case"RAM":this.cpu.RAM.set(null!==e&&void 0!==e?e:0,n)}}},{key:"ticktock",value:function(){this.ticks+=1,this.cpu.tick()}},{key:"load",value:function(){var t=(0,i.Z)((0,r.Z)().mark((function t(n){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.cpu.ROM.load(this.fs,n);case 2:case"end":return t.stop()}}),t,this)})));return function(n){return t.apply(this,arguments)}}()}],[{key:"from",value:function(t){var n=new e;return(0,v.h)(n,t)}}]),e}(p.e),m=function(){function t(){(0,s.Z)(this,t),(0,h.Z)(this,"_cpuTestInstruction_",!0)}return(0,a.Z)(t,[{key:"do",value:function(t){t.ticktock()}},{key:"steps",value:(0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}()},653:function(t,n,e){e.d(n,{e:function(){return l}});var r=e(726),i=e(1092),s=e(7791),a=e(2951),o=e(1976),u=e(4649),c=e(5541),h=e(9956),l=function(){function t(){(0,a.Z)(this,t),(0,u.Z)(this,"instructions",[]),(0,u.Z)(this,"_outputList",[]),(0,u.Z)(this,"_log",""),(0,u.Z)(this,"fs",new h.Wd),(0,u.Z)(this,"_steps",void 0),(0,u.Z)(this,"_step",void 0),(0,u.Z)(this,"breakpoints",new Map)}return(0,o.Z)(t,[{key:"setFileSystem",value:function(t){return this.fs=t,this}},{key:"echo",value:function(t){}},{key:"clearEcho",value:function(){}},{key:"load",value:function(){var t=(0,s.Z)((0,i.Z)().mark((function t(n){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",void 0);case 1:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}()},{key:"compareTo",value:function(){var t=(0,s.Z)((0,i.Z)().mark((function t(n){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",void 0);case 1:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}()},{key:"outputFile",value:function(t){}},{key:"outputList",value:function(t){this._outputList=t}},{key:"addInstruction",value:function(t){this.instructions.push(t)}},{key:"reset",value:function(){return this._steps=(0,i.Z)().mark((function t(n){var e,s,a;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=(0,r.Z)(n.instructions),t.prev=1,e.s();case 3:if((s=e.n()).done){t.next=8;break}return a=s.value,t.delegateYield(a.steps(n),"t0",6);case 6:t.next=3;break;case 8:t.next=13;break;case 10:t.prev=10,t.t1=t.catch(1),e.e(t.t1);case 13:return t.prev=13,e.f(),t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[1,10,13,16]])}))(this),this._step=this._steps.next(),this._log="",this}},{key:"steps",get:function(){return void 0===this._steps&&(this.reset(),this._steps=(0,c.kP)(this._steps,"Reset did not initialize steps"),this._step=(0,c.kP)(this._step,"Reset did not find first step")),this._steps}},{key:"currentStep",get:function(){var t;return null===(t=this._step)||void 0===t?void 0:t.value}},{key:"done",get:function(){var t,n;return null!==(t=null===(n=this._step)||void 0===n?void 0:n.done)&&void 0!==t&&t}},{key:"step",value:function(){return!!this._step.done||(this._step.value.do(this),this._step=this.steps.next(),!1)}},{key:"run",value:function(){var t=(0,s.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.reset();case 1:return t.next=3,this.step();case 3:if(t.sent){t.next=7;break}t.next=1;break;case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"addBreakpoint",value:function(t,n){this.breakpoints.set(t,n)}},{key:"clearBreakpoints",value:function(){this.breakpoints.clear()}},{key:"output",value:function(){var t=this,n=this._outputList.map((function(n){return n.print(t)}));this._log+="|".concat(n.join("|"),"|\n")}},{key:"header",value:function(){var t=this,n=this._outputList.map((function(n){return n.header(t)}));this._log+="|".concat(n.join("|"),"|\n")}},{key:"log",value:function(){return this._log}}]),t}()},184:function(t,n,e){e.d(n,{R:function(){return y},w:function(){return k}});var r=e(1092),i=e(726),s=e(7791),a=e(2951),o=e(1976),u=e(7169),c=e(7591),h=e(4337),l=e(4649),f=e(4625),p=e(5838),v=e(5105),d=e(5354),m=e(1485),k=function(t){(0,c.Z)(e,t);var n=(0,h.Z)(e);function e(){var t;(0,a.Z)(this,e);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return t=n.call.apply(n,[this].concat(i)),(0,l.Z)((0,u.Z)(t),"vm",new d.Vm),t}return(0,o.Z)(e,[{key:"using",value:function(t){return this.fs=t,this}},{key:"with",value:function(t){return this.vm=t,this}},{key:"hasVar",value:function(t,n){return"string"!==typeof t&&(n=t,t="RAM"),"RAM"===t&&void 0!==n&&n>0&&n<p.FH.SIZE||["argument","local","static","constant","this","that","pointer","temp"].includes(t.toLowerCase())}},{key:"getVar",value:function(t,n){var e;return"string"!==typeof t&&(n=t,t="RAM"),"RAM"===t&&void 0!==n&&n>0&&n<p.FH.SIZE?this.vm.RAM.get(n):this.vm.memory.getSegment(t,null!==(e=n)&&void 0!==e?e:0)}},{key:"setVar",value:function(t,n,e){if("string"!==typeof t&&(e=t,t="RAM"),"RAM"===t&&void 0!==e&&e>0&&e<p.FH.SIZE&&this.vm.RAM.set(e,n),e)this.vm.memory.setSegment(t,e,n);else switch(t.toLowerCase()){case"sp":this.vm.memory.SP=n;break;case"arg":case"argument":this.vm.memory.ARG=n;break;case"lcl":case"local":this.vm.memory.LCL=n;break;case"this":this.vm.memory.THIS=n;break;case"that":this.vm.memory.THAT=n}}},{key:"vmstep",value:function(){this.vm.step()}},{key:"load",value:function(){var t=(0,s.Z)((0,r.Z)().mark((function t(n){var e,s,a,o,u,c;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=8;break}return t.next=3,this.fs.readFile(n);case 3:e=t.sent,s=(0,f.Wg)(v.VM.parse(e)),a=s.instructions,(0,f.Wg)(this.vm.load(a)),t.next=30;break;case 8:return t.t0=i.Z,t.next=11,this.fs.scandir(".");case 11:t.t1=t.sent,o=(0,t.t0)(t.t1),t.prev=13,o.s();case 15:if((u=o.n()).done){t.next=22;break}if(!(c=u.value).isFile()||!c.name.endsWith(".vm")){t.next=20;break}return t.next=20,this.load(c.name);case 20:t.next=15;break;case 22:t.next=27;break;case 24:t.prev=24,t.t2=t.catch(13),o.e(t.t2);case 27:return t.prev=27,o.f(),t.finish(27);case 30:(0,f.Wg)(this.vm.bootstrap());case 31:case"end":return t.stop()}}),t,this,[[13,24,27,30]])})));return function(n){return t.apply(this,arguments)}}()}],[{key:"from",value:function(t){var n=new e;return(0,m.h)(n,t)}}]),e}(e(653).e),y=function(){function t(){(0,a.Z)(this,t),(0,l.Z)(this,"_vmTestInstruction_",!0)}return(0,o.Z)(t,[{key:"do",value:function(t){t.vmstep()}},{key:"steps",value:(0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this;case 2:case"end":return t.stop()}}),t,this)}))}]),t}()},7693:function(t,n,e){e.d(n,{a:function(){return s},op:function(){return a},p:function(){return o}});var r=e(9422),i=e(6693);function s(t){return 32768&t?function(t){t&=65535;var n=(4096&t)>>12,e=(4032&t)>>6,r=(56&t)>>3,s=7&t;if(void 0===i.PH.op[e])return"#ERR";var a=i.PH.op[e];n&&(a=a.replace(/A/g,"M"));var o=i.Uc.op[r],u=i.lK.op[s],c=a;o&&(c="".concat(o,"=").concat(c));u&&(c="".concat(c,";").concat(u));return c}(t):function(t){return"@"+(32767&t).toString(10)}(t)}function a(t){return"@"===t[0]?function(t){return parseInt(t.substring(1),10)}(t):function(t){var n,e=t.match((0,r.Z)(/(?:([AMD]{1,3})=)?([-!01ADM&|]{1,3})(?:;(JGT|JLT|JGE|JLE|JEQ|JMP))?/,{assign:1,operation:2,jump:3})),s=null!==(n=null===e||void 0===e?void 0:e.groups)&&void 0!==n?n:{},a=s.assign,u=s.operation,c=s.jump,h=u.includes("M")||a.includes("M"),l=i.Uc.asm[null!==a&&void 0!==a?a:""],f=i.lK.asm[null!==c&&void 0!==c?c:""],p=i.PH.asm[null!==u&&void 0!==u?u:""];return o(h,p,l,f)}(t)}function o(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=57344,s=t?4096:0,a=n<<6,o=(null!==e&&void 0!==e?e:0)<<3,u=null!==r&&void 0!==r?r:0;return i+s+a+o+u}},326:function(t,n,e){e.d(n,{$v:function(){return l},Af:function(){return o},C$:function(){return c},C2:function(){return d},E_:function(){return p},Ly:function(){return f},nN:function(){return v},o5:function(){return u},t1:function(){return h}});var r=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];function i(t){var n;return null!==(n=r[t])&&void 0!==n?n:"X"}function s(t){switch(t){case 0:return"0000";case 1:return"0001";case 2:return"0010";case 3:return"0011";case 4:return"0100";case 5:return"0101";case 6:return"0110";case 7:return"0111";case 8:return"1000";case 9:return"1001";case 10:return"1010";case 11:return"1011";case 12:return"1100";case 13:return"1101";case 14:return"1110";case 15:return"1111";default:return"erro"}}function a(t,n){return 65535&parseInt(t.replace(/[^\d a-f A-F +-.]/g,""),n)}function o(t){return a(t,16)}function u(t){return a(t,10)}function c(t){return a(t.replaceAll(" ",""),2)}function h(t){return t.toUpperCase().includes("X")?o(t):u(t)}function l(t){var n=i((61440&t)>>12),e=i((3840&t)>>8),r=i((240&t)>>4),s=i(15&t);return"0x".concat(n).concat(e).concat(r).concat(s)}function f(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,e=s((61440&t)>>12),r=s((3840&t)>>8),i=s((240&t)>>4),a=s(15&t);return"".concat(e).concat(r).concat(i).concat(a).substring(16-n)}function p(t){return 32768===(t&=65535)?"-32768":32768&t?"-".concat(t=1+~t&32767):"".concat(t)}function v(t){return"".concat(t&=65535)}function d(t,n){var e=~((t&=65535)&(n&=65535));return e&=65535}},5354:function(t,n,e){e.d(n,{Vm:function(){return Z}});var r=e(649),i=e(1026),s=e(726),a=e(2951),o=e(1976),u=e(4649),c=e(4625),h=e(7169),l=e(7591),f=e(4337),p=e(5838),v=function(t){(0,l.Z)(e,t);var n=(0,f.Z)(e);function e(){var t;return(0,a.Z)(this,e),t=n.call(this),(0,u.Z)((0,h.Z)(t),"strict",!0),t.set(0,256),t}return(0,o.Z)(e,[{key:"SP",get:function(){return this.get(0)},set:function(t){this.set(0,t)}},{key:"LCL",get:function(){return this.get(1)},set:function(t){this.set(1,t)}},{key:"ARG",get:function(){return this.get(2)},set:function(t){this.set(2,t)}},{key:"THIS",get:function(){return this.get(3)},set:function(t){this.set(3,t)}},{key:"THAT",get:function(){return this.get(4)},set:function(t){this.set(4,t)}},{key:"statics",get:function(){for(var t=[],n=16;n<256;n++)t.push(this.get(n));return t}},{key:"baseSegment",value:function(t,n){switch(t){case"argument":return this.ARG+n;case"constant":return n;case"local":return this.LCL+n;case"pointer":return this.pointer(n);case"static":return 16+n;case"temp":return 5+n;case"that":return this.THAT+n;case"this":return this.THIS+n}}},{key:"getSegment",value:function(t,n){if("constant"===t)return n;var e=this.baseSegment(t,n);return this.get(e)}},{key:"setSegment",value:function(t,n,e){var r=this.baseSegment(t,n);this.set(r,e)}},{key:"argument",value:function(t){if(this.strict&&t<0)throw new Error("Cannot access negative offsets: ".concat(t));return this.get(this.ARG+t)}},{key:"local",value:function(t){if(this.strict&&t<0)throw new Error("Cannot access negative offsets: ".concat(t));return this.get(this.LCL+t)}},{key:"static",value:function(t){if(this.strict&&t<0)throw new Error("Cannot access negative offsets: ".concat(t));if(this.strict&&t>239)throw new Error("Cannot access statics beyond 239: ".concat(t));return this.get(16+t)}},{key:"constant",value:function(t){return t}},{key:"this",value:function(t){if(this.strict&&t<0)throw new Error("Cannot access negative offsets: ".concat(t));return this.get(this.THIS+t)}},{key:"that",value:function(t){if(this.strict&&t<0)throw new Error("Cannot access negative offsets: ".concat(t));return this.get(this.THAT+t)}},{key:"pointer",value:function(t){if(this.strict&&t<0)throw new Error("Cannot access negative offsets: ".concat(t));if(this.strict&&t>1)throw new Error("pointer out of bounds access (pointer can be 0 for this, 1 for that, but got ".concat(t));return 0===t?3:4}},{key:"temp",value:function(t){if(this.strict&&t<0)throw new Error("Cannot access negative offsets: ".concat(t));if(this.strict&&t>7)throw new Error("Temp out of bounds access (temp can be 0 to 7, but got ".concat(t));return this.get(5+t)}},{key:"push",value:function(t){var n=this.SP;this.set(n,t),this.set(0,n+1)}},{key:"pop",value:function(){if(this.strict&&256===this.SP)throw new Error("Cannot pop the stack below 256 in strict mode");return this.set(0,this.SP-1),this.get(this.SP)}},{key:"pushFrame",value:function(t,n,e){var r=this.SP,i=r-n;this.set(r,t),this.set(r+1,this.LCL),this.set(r+2,this.ARG),this.set(r+3,this.THIS),this.set(r+4,this.THAT),this.set(2,i),this.set(1,r+5);for(var s=r+5,a=0;a<e;a++)this.set(s+1,0);return this.set(0,s+e),r}},{key:"popFrame",value:function(){var t=this.LCL,n=this.get(t-5),e=this.pop();return this.set(this.ARG,e),this.set(0,this.ARG+1),this.set(4,this.get(t-1)),this.set(3,this.get(t-2)),this.set(2,this.get(t-3)),this.set(1,this.get(t-4)),n}},{key:"getFrame",value:function(t,n,e,i,s,a){var o=t-n,u=t+5,c=u+e,h=a-c;return{args:{base:o,count:n,values:(0,r.Z)(this.map((function(t,n){return n}),o,o+n))},locals:{base:u,count:e,values:(0,r.Z)(this.map((function(t,n){return n}),u,u+e))},stack:{base:c,count:h,values:(0,r.Z)(this.map((function(t,n){return n}),c,c+h))},this:{base:c,count:i,values:(0,r.Z)(this.map((function(t,n){return n}),this.THIS,this.THIS+i))},that:{base:c,count:s,values:(0,r.Z)(this.map((function(t,n){return n}),this.THIS,this.THIS+s))},frame:{RET:this.get(t),LCL:this.LCL,ARG:this.ARG,THIS:this.THIS,THAT:this.THAT}}}},{key:"getVmState",value:function(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:240,e=(0,r.Z)(this.map((function(t,n){return n}),5,13)),i=(0,r.Z)(this.map((function(t,n){return n}),13,16)),s=(0,r.Z)(this.map((function(t,n){return n}),16,16+n));return t={},(0,u.Z)(t,"0: SP",this.SP),(0,u.Z)(t,"1: LCL",this.LCL),(0,u.Z)(t,"2: ARG",this.ARG),(0,u.Z)(t,"3: THIS",this.THIS),(0,u.Z)(t,"4: THAT",this.THAT),(0,u.Z)(t,"temps",e),(0,u.Z)(t,"internal",i),(0,u.Z)(t,"static",s),t}},{key:"binOp",value:function(t){var n=65535&t(this.get(this.SP-2),this.get(this.SP-1));this.set(this.SP-2,n),this.set(0,this.SP-1)}},{key:"unOp",value:function(t){var n=65535&t(this.get(this.SP-1));this.set(this.SP-1,n)}},{key:"comp",value:function(t){this.binOp((function(n,e){return t(n,e)?-1:0}))}}]),e}(p.FH),d="__implicit",m="__bootstrap";function k(t){return{name:"__bootstrap",nVars:0,opBase:0,labels:{},operations:[{op:"function",name:"__bootstrap",nVars:0},{op:"call",name:t,nArgs:0}]}}var y="__END",g={name:"Sys.init",labels:{END:1},nVars:0,opBase:0,operations:[{op:"call",name:"main",nArgs:0},{op:"label",label:y},{op:"goto",label:y}]},Z=function(){function t(){(0,a.Z)(this,t),(0,u.Z)(this,"memory",new v),(0,u.Z)(this,"entry",""),(0,u.Z)(this,"functionMap",{}),(0,u.Z)(this,"executionStack",[]),(0,u.Z)(this,"functions",[]),(0,u.Z)(this,"program",[]),(0,u.Z)(this,"staticCount",0),(0,u.Z)(this,"statics",{})}return(0,o.Z)(t,[{key:"registerStatic",value:function(t,n){var e,r,i=t.split(".")[0],s=null!==(e=this.statics[i])&&void 0!==e?e:[];this.statics[i]=s;var a=null!==(r=s[n])&&void 0!==r?r:this.staticCount++;return s[n]=a,a}},{key:"registerStatics",value:function(){for(var t=0,n=Object.values(this.functionMap);t<n.length;t++){var e,r=n[t],i=(0,s.Z)(r.operations);try{for(i.s();!(e=i.n()).done;){var a=e.value;["push","pop"].includes(a.op)&&"static"===a.segment&&(a.offset=this.registerStatic(r.name,a.offset))}}catch(o){i.e(o)}finally{i.f()}}}},{key:"RAM",get:function(){return this.memory}},{key:"Keyboard",get:function(){return this.memory.keyboard}},{key:"Screen",get:function(){return this.memory.screen}},{key:"invocation",get:function(){var t=this.executionStack.at(-1);if(void 0===t)throw new Error("Empty execution stack!");return t}},{key:"currentFunction",get:function(){var t=this.functionMap[this.invocation.function];if(void 0===t)throw new Error("Executing undefined function ".concat(this.invocation.function));return t}},{key:"operation",get:function(){if(this.invocation.opPtr>this.currentFunction.operations.length)throw new Error("Current operation step beyond end of function operations (".concat(this.invocation.opPtr," > ").concat(this.currentFunction.operations.length,")"));return this.currentFunction.operations[this.invocation.opPtr]}},{key:"load",value:function(n){var e;"function"!==(null===(e=n[0])||void 0===e?void 0:e.op)&&n.unshift({op:"function",name:d,nVars:0});for(var r=0;r<n.length;){var s=t.buildFunction(n,r);if((0,c.dZ)(s))return(0,c.UG)(new Error("Failed to build VM",{cause:(0,c.UG)(s)}));var a=(0,c.Wg)(s),o=(0,i.Z)(a,2),u=o[0],h=o[1];if(this.functionMap[u.name]&&this.memory.strict&&u.name!==d)return(0,c.UG)(new Error("VM Already has a function named ".concat(u.name)));this.functionMap[u.name]=u,r=h}return this.registerStatics(),(0,c.Ok)(this)}},{key:"bootstrap",value:function(){var t=this;if(!this.functionMap[g.name]&&this.functionMap.main&&(this.functionMap[g.name]=g),this.functionMap[g.name])this.functionMap[m]=k(g.name),this.entry=m;else if(this.functionMap[d])this.entry=d;else{var n=Object.keys(this.functionMap);1===n.length&&(this.functionMap[m]=k(n[0]),this.entry=m)}if(this.functionMap[d]&&this.functionMap[m])return(0,c.UG)(new Error("Cannot use both bootstrap and an implicit function"));if(""===this.entry)return(0,c.UG)(Error("Could not determine an entry point for VM"));this.functions=Object.values(this.functionMap),this.functions.sort((function(n,e){return n.name===t.entry?-1:n.name===t.entry?1:0}));var e=0;return this.program=this.functions.reduce((function(t,n){return n.opBase=e,e+=n.operations.length,t.concat(n.operations)}),[]),this.reset(),(0,c.Ok)(this)}},{key:"reset",value:function(){this.executionStack=[{function:this.entry,opPtr:1,frameBase:256,nArgs:0}],this.memory.reset(),this.memory.set(0,256)}},{key:"step",value:function(){var t,n=null!==(t=this.operation)&&void 0!==t?t:{op:"return"};switch(n.op){case"push":var e=this.memory.getSegment(n.segment,n.offset);this.memory.push(e);break;case"pop":var r=this.memory.pop();this.memory.setSegment(n.segment,n.offset,r);break;case"add":this.memory.binOp((function(t,n){return t+n}));break;case"sub":this.memory.binOp((function(t,n){return t-n}));break;case"neg":this.memory.unOp((function(t){return-t}));break;case"and":this.memory.binOp((function(t,n){return t&n}));break;case"or":this.memory.binOp((function(t,n){return t|n}));break;case"not":this.memory.unOp((function(t){return~t}));break;case"eq":this.memory.comp((function(t,n){return t===n}));break;case"lt":this.memory.comp((function(t,n){return t<n}));break;case"gt":this.memory.comp((function(t,n){return t>n}));break;case"goto":this.goto(n.label);break;case"if-goto":0!=this.memory.pop()&&this.goto(n.label);break;case"call":var i=n.name,s=this.functionMap[i];if(!s)throw new Error("Calling unknown function ".concat(i));var a=this.memory.pushFrame(this.invocation.opPtr,n.nArgs,s.nVars);this.executionStack.push({function:i,opPtr:0,nArgs:n.nArgs,frameBase:a});break;case"return":this.executionStack.pop();var o=this.memory.popFrame();this.invocation.opPtr=o}this.invocation.opPtr+=1}},{key:"goto",value:function(t){if(void 0===this.currentFunction.labels[t])throw new Error("Attempting GOTO to unknown label ".concat(t," in ").concat(this.currentFunction.name));this.invocation.opPtr=this.currentFunction.labels[t]}},{key:"write",value:function(t){var n=this;t.map((function(t){var e=(0,i.Z)(t,2),r=e[0],s=e[1];n.memory.set(r,s)}))}},{key:"read",value:function(t){var n=this;return t.map((function(t){return n.memory.get(t)}))}},{key:"vmStack",value:function(){var t=this;return this.executionStack.map((function(n,e){var r=t.executionStack[e+1],i=r?r.frameBase-r.nArgs:t.memory.get(0);return t.makeFrame(n,i)}))}},{key:"makeFrame",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.invocation,n=arguments.length>1?arguments[1]:void 0,e=this.functionMap[t.function];if(["__implicit","__bootstrap"].includes(e.name)){var i,s=256,a=this.executionStack[1],o=a?a.frameBase-a.nArgs:this.memory.get(0);return i={fn:e,args:{base:256,count:0,values:[]},locals:{base:256,count:0,values:[]},stack:{base:256,count:o-s,values:(0,r.Z)(this.memory.map((function(t,n){return n}),s,o))}},(0,u.Z)(i,"this",{base:0,count:0,values:[]}),(0,u.Z)(i,"that",{base:0,count:0,values:[]}),(0,u.Z)(i,"frame",{ARG:0,LCL:0,RET:0,THAT:0,THIS:0}),i}var c=this.memory.getFrame(t.frameBase,t.nArgs,e.nVars,0,0,n);return c.fn=e,c}},{key:"derivedLine",value:function(){return this.currentFunction.opBase+this.invocation.opPtr}},{key:"writeDebug",value:function(){var t=this.derivedLine(),n=Math.max(t-5,0),e=Math.min(t+3,this.program.length),r=this.program.slice(n,e).map((function(e,r){return"".concat(r===t-n?"->":"  "," ").concat(function(t){switch(t.op){case"add":case"and":case"sub":case"eq":case"gt":case"lt":case"neg":case"not":case"or":case"return":return"  ".concat(t.op);case"goto":return"  ".concat(t.op,"    ").concat(t.label);case"if-goto":return"  ".concat(t.op," ").concat(t.label);case"label":return"".concat(t.op,"     ").concat(t.label);case"call":return"  ".concat(t.op,"    ").concat(t.name," ").concat(t.nArgs);case"function":return"".concat(t.op,"  ").concat(t.name," ").concat(t.nVars);case"pop":return"  ".concat(t.op,"     ").concat(t.segment," ").concat(t.offset);case"push":return"  ".concat(t.op,"    ").concat(t.segment," ").concat(t.offset)}}(e))})).join("\n"),i=this.vmStack().at(-1);return i?r+"\n\n"+function(t){var n,e;return["Frame: ".concat(null!==(n=null===(e=t.fn)||void 0===e?void 0:e.name)&&void 0!==n?n:"Unknown Fn"," ARG:").concat(t.frame.ARG," LCL:").concat(t.frame.LCL),"Args: ".concat(b(t.args)),"Lcls: ".concat(b(t.locals)),"Stck: ".concat(b(t.stack))].join("\n")}(i):r}}],[{key:"build",value:function(n){var e=new t,r=e.load(n);return(0,c.dZ)(r)?r:e.bootstrap()}},{key:"buildFunction",value:function(t,n){if("function"!==t[n].op)return(0,c.UG)(Error("Only call buildFunction at the initial Function instruction"));var e=t[n],r=e.name,i=e.nVars,s={name:r,nVars:i,labels:{},operations:[{op:"function",name:r,nVars:i}],opBase:0};n+=1;t:for(;n<t.length;){switch(t[n].op){case"function":break t;case"add":case"sub":case"neg":case"and":case"or":case"not":case"gt":case"lt":case"eq":s.operations.push({op:t[n].op});break;case"push":case"pop":s.operations.push({op:t[n].op,segment:t[n].segment,offset:t[n].offset});break;case"call":s.operations.push({op:"call",name:t[n].name,nArgs:t[n].nArgs});break;case"goto":case"if-goto":s.operations.push({op:t[n].op,label:t[n].label});break;case"label":var a=t[n].label;if(s.labels[a])throw new Error("Cannot redeclare label ".concat(a," in function ").concat(s.name," (previously at ").concat(s.labels[a],")"));s.labels[a]=s.operations.length,s.operations.push({op:"label",label:a});break;case"return":s.operations.push({op:"return"})}n+=1}return s.name===d&&(s.labels[y]=s.operations.length,s.operations.push({op:"label",label:y}),s.operations.push({op:"goto",label:y})),(0,c.Ok)([s,n])}}]),t}();function b(t){return"[".concat(t.base,";").concat(t.count,"][").concat(t.values.join(", "),"]")}}}]);
//# sourceMappingURL=949.f3039c73.chunk.js.map